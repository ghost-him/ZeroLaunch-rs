set -e

echo "Running pre-commit checks..."

# 1. æ„å»ºå‰ç«¯ï¼ˆç¡®ä¿ dist æ–‡ä»¶å¤¹å­˜åœ¨ï¼‰
echo "ğŸ—ï¸  Building frontend..."
bun run build

# 2. å¤åˆ¶ i18n locales æ–‡ä»¶åˆ° src-tauri
echo "ğŸ“¦ Copying i18n locales to src-tauri..."
SRC_LOCALES_DIR="src/i18n/locales"
DEST_DIR="src-tauri/locales"

if [ ! -d "$DEST_DIR" ]; then
  mkdir -p "$DEST_DIR"
fi

cp -r "$SRC_LOCALES_DIR"/* "$DEST_DIR"/
echo "âœ“ i18n locales files copied to src-tauri/locales/"

# 3. Rust æ ¼å¼æ£€æŸ¥
echo "ğŸ¨ Running Rust formatting check..."
( cd src-tauri && cargo fmt --all -- --check )

# 4. Rust é™æ€æ£€æŸ¥
echo "ğŸ“‹ Running Rust clippy..."
( cd src-tauri && cargo clippy --all-targets --all-features -- -D warnings )

# 5. Rust å•å…ƒæµ‹è¯•
echo "ğŸ§ª Running Rust tests..."
( cd src-tauri && cargo test --all-features )

echo "âœ… All pre-commit checks passed!"
